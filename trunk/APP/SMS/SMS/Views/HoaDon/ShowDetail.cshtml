@model SMS.Models.InvoicesModel
@using PagedList.Mvc;

@{
    ViewBag.Title = "Chi tiết hóa đơn bán hàng";
}
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
<link href="~/Content/css/style.css" rel="stylesheet" type="text/css" />
<link href="~/Content/KhachHang.css" rel="stylesheet" type="text/css" />

<h2>Chi tiết hóa đơn bán hàng</h2>
<hr style="width:100%" />
@using (Html.BeginForm("ShowDetail", "HoaDon", FormMethod.Post, new { @name = "ShowDetail", @id = "ShowDetail" }))
{

    @Html.ValidationSummary(true, "Vui lòng kiểm tra lại các giá trị đã nhập!");
    <div>
        <fieldset>
            <div class="left">
                @Html.HiddenFor(u => u.Infor.MA_HOA_DON)
                <label> Tên khách hàng</label>
            </div>
            <div class="right">
                <label>@Model.Infor.TEN_KHACH_HANG</label>
            </div>
            <div class="left">
                <label> Người bán hàng </label>
            </div>
            <div class="right">
                <label> @Model.Infor.TEN_NGUOI_BAN</label>
            </div>
            @if(Model.Infor.STATUS >= 2)
            {
                <div class="left">
                <label> Người thu tiền </label>
            </div>
            <div class="right">
                @if (!String.IsNullOrEmpty(@Model.Infor.TEN_NV_TT))
                {
                    <label>@Model.Infor.TEN_NV_TT</label>
                }
                else
                {
                    <label>... </label>
                }
            </div>
            }
            
            <div class="left">
                <label> Ngày giao hàng </label>
            </div>
            <div class="right">
                @if (@Model.Infor.NGAY_GIAO != null)
                {
                    <label>@Convert.ToDateTime(@Model.Infor.NGAY_GIAO).ToString("dd/MM/yyyy") </label>
                }else
                {
                    <label>...</label>
                }
                
            </div>
            <div class="left">
                <label> Địa chỉ giao hàng </label>
            </div>
            <div class="right">
                <label>@Model.Infor.DIA_CHI_GIAO_HANG</label>
            </div>
@if(Model.Infor.STATUS >= 2)
            {
            <div class="left">
                <label> Số tiền khách trả </label>
            </div>
            <div class="right">
                @if (Model.Infor.SO_TIEN_KHACH_TRA != null)
                {
                    <label>@Convert.ToDouble(Model.Infor.SO_TIEN_KHACH_TRA).ToString("0,0.00") </label>
                }
                else
                {
                    <label>0</label>
                }
            </div>
            <div class="left">
                <label> So tiền khách nợ </label>
            </div>
            <div class="right">
                @if (Model.Infor.SO_TIEN_NO_GOI_DAU != null)
                {
                    <label>@Convert.ToDouble(Model.Infor.SO_TIEN_NO_GOI_DAU).ToString("0,0.00") </label>

                }
                else
                {
                    <label>0</label>
                }
            </div>
}
            <div class="left">
                <label> Tình trạng hóa đơn </label>
            </div>
            <div class="right">
                @if (Model.Infor.STATUS == 1)
                {
                    <label> Tạo mới - Chưa thu tiền </label>

                }
                else if (Model.Infor.STATUS == 2)
                {
                    <label> Đã thu tiền</label>
                }
                else if (Model.Infor.STATUS == 3)
                {
                    <label> Đã giao hàng</label>
                }
                else
                {
                    <label> Không xác định </label>
                }

            </div>
            <div style="clear:both"></div>
            <hr style="width:100%" />
            @if (Model.Infor.STATUS == 1)
            {
                <table border="1">
                <tr>
                    <td width="40%" >
                       <label>Số tiền khách thanh toán</label> 
                    </td>
                    <td width="60%" >
                        @Html.TextBoxFor(u => u.Infor.SO_TIEN_KHACH_TRA, new { id = "payMoney" })
                    </td>

                </tr>
                <tr>
                    <td width="40%" >
                        <label>Tiền khách nợ </label>
                    </td>
                    <td width="60%" >
                        @Html.TextBoxFor(u => u.Infor.SO_TIEN_NO_GOI_DAU, new { id = "debitMoney" })
                    </td>
                </tr>
            </table>
              
                    <input type="button" id ="paymentFirst"style="width:300px" value="Thu tiền" />
    
            }
            @if (@Model.Infor.STATUS == 2)
            {
                <input type="submit" style="width:300px" value="Cấp quyền thay đổi hóa đơn" />
            }
            <input type="button" style="width:300px" value="Trở về danh sách hóa đơn" onclick="window.location.href='@Url.Action("Index","HoaDon")'" />
            <table border="1" cellpadding="0" cellspacing="0" style="width:100%" id="MainTable">
                <tr>
                    <td class='inner colwidth head ' width="5%;">
                        STT
                    </td>
                    <td class='inner colwidth head ' width="15%">
                        Tên sản phầm
                    </td>
                    <td class='inner colwidth head ' width="15%">
                        Số lượng
                    </td>
                    <td class='innerLast colwidth head ' width="15%">
                        Đơn vị
                    </td>
                    <td class='inner colwidth head ' width="15%">
                        Đơn giá
                    </td>
                    <td class='inner colwidth head ' width="15%">
                        Chiếc khấu (%)
                    </td>
                    <td class='innerLast colwidth head '  width="15%">
                       Thành tiền
                    </td>
                </tr>
                @{
    int i = 0;
    double total = 0;
    double price = 0;
   double quantity = 0;
    double discount = 0 ;
    double totalAll = 0;
                }
@foreach (var detail in Model.detailList)
{
    i += 1;
    quantity = Convert.ToDouble(detail.SO_LUONG);
    price = Convert.ToDouble(detail.DON_GIA);
    discount = Convert.ToDouble(detail.PHAN_TRAM_CHIEC_KHAU);
    total = quantity * price - quantity * price * discount / 100;
    totalAll += total;
    <tr>
        <td class="inner colwidth" width="5%;">
            @i
        </td>
        <td class="inner colwidth">
           @detail.TEN_SAN_PHAM
        </td>
        <td class="inner colwidth">
            @detail.SO_LUONG.ToString("0,0.00")
        </td>
        <td class="inner colwidth">
            @detail.TEN_DON_VI
        </td>
        <td class="inner colwidth">
            @detail.DON_GIA.ToString("0,0.00")
        </td>
        <td class="inner colwidth">
            @detail.PHAN_TRAM_CHIEC_KHAU.ToString("0,0.00")
        </td>
        <td class="innerLast colwidth">
            @total.ToString("0,0.00")
        </td>
    </tr>
}
                <tr style="background-color:lightgray">
                    <td class="innerLast colwidth" colspan="6">
                        <strong> Tồng cộng</strong>
                    </td>
                    <td class="innerLast colwidth">
                        <strong>@totalAll.ToString("0,0.00")</strong>
                    </td>
                </tr>
                </table>
            <div style="clear:both"></div>
            <hr style="width:100%" />
            @if(@Model.Infor.STATUS == 2)
            {
                <input type="submit" style="width:300px" value="Cấp quyền thay đổi hóa đơn"/>
            }
            @if (@Model.Infor.STATUS == 1)
{
    <input type="button" style="width:300px" value="Thu tiền" onclick="window.location.href='@Url.Action("Payment", "HoaDon", new { @id = @Model.Infor.MA_HOA_DON })'" />
}
            <input type="button" style="width:300px" value="Trở về danh sách hóa đơn" onclick="window.location.href='@Url.Action("Index","HoaDon")'" />
        </fieldset>
    </div>
}


<script type="text/javascript">
    $(document).ready(function () {
        $("#paymentFirst").click(function () {
            var form = $("#ShowDetail");
            form.attr("action", "/HoaDon/Payment");
            form.submit();
        });
    });
</script>